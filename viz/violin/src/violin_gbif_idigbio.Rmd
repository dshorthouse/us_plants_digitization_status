---
title: "US Plants Digitization Status"
author: "Jocelyn Pender"
date: "10/07/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=8, fig.height=10) 

```

## US Plant Collections Digitization Status

### Degree of Digitization, US Plant Collection Data from GBIF and iDigBio

```{r cars}
library(tidyverse)
library(ggplot2)
```


```{r gbif_idigbio_data_prep}
# import the iDigBio data dump
idigbio_us_dataset <- read_csv("../../../idigbio_institutionCode_summmary/idigbio_institutionCode_MIDS_2020.07.11.csv")

# import the GBIF data dump
gbif_us_dataset <- read_csv("../../../gbif_institutionCode_summmary/gbif_us_institutionCode_MIDS_2020.07.08.csv")
```


```{r data_prep}

percentage_pivot <- function(us_dataset) {

  # Generate percentage of totals as data
  percentage_gbif_us_dataset <- us_dataset[, 3:ncol(us_dataset)] %>%
    mutate(across(everything()), . / us_dataset$total) %>% cbind(., us_dataset$institutionCode)
  colnames(percentage_gbif_us_dataset)[15] <- "institutionCode" # clean up yucky column name after cbind operation
  
  # Convert data to a long format
  pivoted_percentage_gbif_us_dataset <- pivot_longer(percentage_gbif_us_dataset, -institutionCode, names_to = "variable", values_to = "coverage")
  
  pivoted_percentage_gbif_us_dataset$variable <- as.factor(pivoted_percentage_gbif_us_dataset$variable) # prepare data type for violin plots
  
  return(pivoted_percentage_gbif_us_dataset)
}
```

```{r}
gbif_pivoted_percentage_us_dataset <- percentage_pivot(gbif_us_dataset)
gbif_pivoted_percentage_us_dataset
```
```{r}
idigbio_pivoted_percentage_us_dataset <- percentage_pivot(idigbio_us_dataset)
idigbio_pivoted_percentage_us_dataset
```


```{r}
# Sort columns based on MIDS level
gbif_us_dataset <- gbif_us_dataset %>% relocate(has_catalogNumber, has_collectionCode, has_countryCode, has_speciesKey, has_locality, has_eventDate, has_recordedBy, has_coordinates, has_image, has_identifiedBy, has_dateIdentified, has_higherGeography)
```


```{r}
p <- ggplot(pivoted_percentage_gbif_us_dataset, aes(x=variable, y=coverage)) + 
  geom_violin(scale = "width") + coord_flip() + stat_summary(fun=median, geom="point", size=2, color="red") + scale_color_brewer(palette="Dark2") # median points in red

p
```

